#!/bin/bash

set -e
set -o errtrace
set -o pipefail
set -o nounset

true "$0: INFO: START"

command -v start-stop-daemon >/dev/null

pidfile="/run/user/$(id -u)/dist-virtual-keyboard.pid"

terminate_wvkbd() {
  start-stop-daemon --stop --quiet --retry=TERM/5/KILL/5 --pidfile "$pidfile" &>/dev/null || true
}

launch_wvkbd() {
  program="/usr/bin/wvkbd-mobintl"

  start-stop-daemon \
    --background \
    --make-pidfile \
    --pidfile "$pidfile" \
    --exec "$program" \
    --start
}

if (( $# > 0 )) && [ "$1" = '--terminate' ]; then
  terminate_wvkbd
  exit
fi

launch_wvkbd
